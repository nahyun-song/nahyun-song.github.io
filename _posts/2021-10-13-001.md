---
layout: single
title:  "20211013 가설검정/t-분포/신뢰구간"
categories: 
    - AI_bootcamp
---





## 1. 통계학이 데이터분석분야에서 왜 필요할까?

  - 데이터를 요약하고 데이터를 통해 어떤 의미있는 정보를 도출해내는 역할이 바로 "통계학"이 하는 역할이다.\
      자료 (data) → 통계학 (statistics) → 정보 (information)
  - 데이터를 요약하고 시각화하여 단순한 데이터의 나열이 아닌 데이터 정보를 의미 있게 전달한다.
     + 분석한 데이터를 바탕으로 앞으로의 일을 예측하거나 우리가 알고싶은 규칙(가설)을 일반화하는 등의 역할
  - 불확실하고 예측할 수 없는 미래를 예측하고, 좋은 성과와 결과를 위해 어떤 결정을 내려야 할 때 객관적으로 근거를 가지고 판단을 하도록 도와준다.

## 2. H0, H1 가설정리 / 1종, 2종오류 / 검정통계량 / p-value / 신뢰구간 각각 키워드 정리

  1. H0, H1 가설정리\
    - 귀무가설 (Null Hypothesis, H0) : 기존의 주장\
      ex) 집단 간 평균에 차이가 없다, 두 변수 간의 관계가 없다.\
    - 대안가설 (Alternarive Hypothesis, H1) : 모집단에 대한 새로운 주장\
      ex) 집단 간 평균에 차이가 있다, 두 변수 간의 관계가 있다.
      
  2. 1종, 2종오류
    - 1종 오류 : 귀무가설이 참임에도 불구하고 귀무가설을 기각하는 오류 (실제로 효과가 없는데 효과가 있다고 판단)
      + 유의수준(𝛼) - 1종 오류가 발생할 확률
    - 2종 오류 : 귀무가설이 거짓임에도 불구하고 귀무가설을 채택하는 오류 (실제로 효과가 있는데 효과가 없다고 판단)
      + 검정력(𝛽) - 2종 오류가 발생할 확률
    ex) 혈압 개선 약품을 테스트한다고 했을 때, 실제로는 이 약이 효과가 없음에도 불구하고 효과가 있는 것으로 잘못 판단하였다면(1종 오류), 개발한 약품 회사는 큰 손해를 입게 될 것 \
        -> 1종 오류가 2종 오류보다 더 중요하다 (기존 명제인 귀무 가설을 잘못 판단하였기 때문에)\
        \
        다만, 암 진단과 같은 경우에는 1종 오류보다 2종 오류를 더 중요하게 생각하고 환자를 진단함.\
        \
        귀무가설 : 환자가 암에 걸리지 않았다\
        대립가설 : 환자가 암에 걸렸다\
        \
        귀무가설이 거짓인데 귀무가설을 채택하고 대립가설을 기각한다면, 환자는 암 진단을 했음에도 오진으로 인해 치료시기를 놓칠 수 있기 때문\
        \
        이 경우에도 1종 오류에 대해 너무 관대해지면 사화적, 정신적 비용을 증가시키는 부작용이 발생할 수 있음\
        -> 가설을 설정하는 목적과 환경을 고려하여 극단적이지 않은 결과가 나오도록 세밀하게 실험 설계를 해야한다.
        
  3. 검정통계량
    - 통계량(statistic) : 모집단의 모수를 추정하기 위하여 표본에서 계산한 추정량의 값. 표본에 따라 값이 다른 확률변수로서 확률분포를 가짐\
      ex) 표본평균, 표본분산 등
    - 검정통계량 : 가설검정에서 기각역을 결정하는 기준이 되는 통계량\
      ex) z통계량(정규분포), t통계량(t분포), x^2통계량(카이스퀘어분포), F통계량(F분포)
    
  4. p-value
    - p-value : 기각역에 해당되는 검정통계량이 산출될 확률, 주어진 가설에 대해 '얼마나 근거가 있는지'를 0과 1사이의 값으로 스케일링한 값
             -> p-value가 낮다 = 우연히 일어난 일이 아니다
                              = 통계적으로 유의하다
                              = 귀무가설이 틀렸을 확률이 높다
                              = 귀무가설을 기각하고 대립가설을 채택한다
                                
  5. 신뢰구간
    - 신뢰도 : 예측이 맞을 확률
      + 신뢰도가 95%라는 의미는 표본을 100번 뽑았을 때 95번은 신뢰구간 안에 모집단의 평균이 포함된다는 것
    - 신뢰구간 : 모수의 범위를 한정하는 구간, 모수가 속할 것으로 여겨지는 구간
      + 평균값이 신뢰구간 안에 들어온다 = 현재의 분포에 비추어볼 때 충분히 측정될 수 있는(신뢰할 수 있는) 값이다
      + 평균값이 신뢰구간 밖에 있다 = 현재의 분포에 비추어볼 때 거의 기적에 가까운 측정 값이다, 다시 말해 일어날 법하지 않다

## 3. 검정 통계량중 t-test를 선택한 이유 / one-sample t-test 개념 및 python 실습

  1. 검정 통계량중 t-test를 선택한 이유
    - t-test : 모집단의 표준편차가 알려지지 않았을 때, 정규분포의 모집단에서 모은 표본의 평균값에 대한 가설검정 방법
      + 표본의 크기가 작아 정규분포를 이룬다고 가정할 수 없을 경우 두 집단의 평균을 비교할 때
  
  2. one-sample t-test 개념
    - one-sample t-test : 한 개의 sample값들의 평균이 특정값과 동일한지 비교
        + paired t-test : 한 개의 sample값들의 평균을 시간적으로 간격을 두고 시간의 경과에 따른 차이를 비교
    
  3. python 실습
    - 1-Sample T-tests 연습

### **'서울시에는 구별로 평균적으로 약 400 그루 정도의 `이팝나무`가 있다'** 라는 가설에 대한 가설검정


```python
import pandas as pd

trees = pd.read_csv('https://ds-lecture-data.s3.ap-northeast-2.amazonaws.com/seoul_tree/seoul_tree.txt', sep = '\t', skiprows = 1)

trees = trees.replace({'-':0})
```


```python
trees.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>기간</th>
      <th>자치구</th>
      <th>노선수</th>
      <th>수량</th>
      <th>은행나무</th>
      <th>양버즘나무</th>
      <th>느티나무</th>
      <th>왕벚나무</th>
      <th>은단풍나무</th>
      <th>메타세콰이어</th>
      <th>...</th>
      <th>튜울립나무</th>
      <th>칠엽수</th>
      <th>포플러</th>
      <th>느릅나무</th>
      <th>살구나무</th>
      <th>무궁화</th>
      <th>소나무</th>
      <th>목련</th>
      <th>이팝나무</th>
      <th>기타</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019</td>
      <td>서울시</td>
      <td>1,412</td>
      <td>307,351</td>
      <td>108,050</td>
      <td>62,474</td>
      <td>37,473</td>
      <td>34,150</td>
      <td>545</td>
      <td>5,171</td>
      <td>...</td>
      <td>948</td>
      <td>1,533</td>
      <td>7</td>
      <td>504</td>
      <td>234</td>
      <td>2,374</td>
      <td>4,539</td>
      <td>378</td>
      <td>20,088</td>
      <td>20,112</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019</td>
      <td>종로구</td>
      <td>70</td>
      <td>7,329</td>
      <td>4,072</td>
      <td>1,071</td>
      <td>619</td>
      <td>421</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>239</td>
      <td>0</td>
      <td>711</td>
      <td>29</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019</td>
      <td>중구</td>
      <td>48</td>
      <td>8,250</td>
      <td>3,640</td>
      <td>162</td>
      <td>460</td>
      <td>289</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>21</td>
      <td>46</td>
      <td>2,162</td>
      <td>0</td>
      <td>470</td>
      <td>817</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019</td>
      <td>용산구</td>
      <td>39</td>
      <td>7,835</td>
      <td>4,444</td>
      <td>1,422</td>
      <td>373</td>
      <td>262</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>13</td>
      <td>16</td>
      <td>0</td>
      <td>0</td>
      <td>39</td>
      <td>0</td>
      <td>51</td>
      <td>126</td>
      <td>198</td>
      <td>780</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019</td>
      <td>성동구</td>
      <td>38</td>
      <td>8,120</td>
      <td>1,090</td>
      <td>2,401</td>
      <td>1,975</td>
      <td>602</td>
      <td>29</td>
      <td>48</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>59</td>
      <td>0</td>
      <td>0</td>
      <td>53</td>
      <td>0</td>
      <td>709</td>
      <td>646</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 24 columns</p>
</div>




```python
#`서울시`, `공원녹지사업소`, `시설관리공단` 부분의 데이터는 제외
trees.drop(trees.index[(trees['자치구'] == '서울시') | \
                       (trees['자치구'] == '공원녹지사업소') | \
                       (trees['자치구'] == '시설관리공단')], inplace=True)

#이팝나무 column의 자료형 변경(object -> int)
tree1 = pd.to_numeric(trees['이팝나무'].str.replace(',',''))

#한 개의 샘플값들의 평균이 400과 같은지 확인하기 위해 p-value 구하기(ttest_1samp)
from scipy import stats
pv1 = stats.ttest_1samp(tree1, 400).pvalue
pv1
```




    0.002470712850935819



귀무가설 : 서울시 이팝나무 수의 평균은 400과 차이가 없다. (평균 == 400)\
대립가설 : 서울시 이팝나무 수의 평균은 400과 차이가 있다. (평균 != 400)\
\
p-value가 0.05보다 현저히 작으므로 귀무가설을 기각한다 -> 대립가설을 채택한다 -> 서울시 이팝나무 수의 평균은 400이 아니다.

## 4. two-sample t-test 개념 및 python 실습

  1. two-sample t-test 개념
    - two-sample t-test : 두 개의 sample값들의 평균이 서로 동일한지 비교
    
  2. python 실습
    - 2-Sample T-tests 연습

### **'서울시의 구별 평균 느티나무수와 왕벚나무의 수는 차이가 없다'** 라는 가설에 대한 가설검정


```python
#느티나무와 왕벚나무 column의 자료형 변경(object -> int)
tree2 = pd.to_numeric(trees['느티나무'].str.replace(',',''))
tree3 = pd.to_numeric(trees['왕벚나무'].str.replace(',',''))

#두 개의 샘플값들의 평균이 차이가 있는지 확인하기 위해 p-value 구하기(ttest_ind)
pv2 = stats.ttest_ind(tree2,tree3).pvalue
pv2
```




    0.6455096880085703



귀무가설 : 서울시 느티나무 수의 평균과 왕벚나무 수의 평균은 차이가 없다.\
대립가설 : 서울시 느티나무 수의 평균과 왕벚나무 수의 평균은 차이가 있다.\
\
p-value가 0.05보다 현저히 크므로 귀무가설을 기각할 수 없다 -> 대립가설을 기각한다 -> 서울시 느티나무 수의 평균과 왕벚나무 수의 평균은 차이가 없다.

## 5. 하나의 데이터셋을 가지고 위의 flow로 간단한 python 실습 (paired-sample t-test)


```python
before = [0.430,0.266,0.567,0.531,0.707,0.716,0.651,0.589,0.469,0.723]
after  = [0.415,0.238,0.390,0.410,0.605,0.609,0.632,0.523,0.411,0.612]
```


```python
#한 개의 샘플들의 평균이 전 후 차이가 있는지 확인하기 위해 p-value 구하기(ttest_rel)
pv3 = stats.ttest_rel(before,after).pvalue
pv3
```




    0.0008911154578225479



귀무가설 : 위 샘플의 전과 후의 평균은 차이가 없다.\
대립가설 : 위 샘플의 전과 후의 평균은 차이가 있다.\
\
p-value가 0.05보다 현저히 작으므로 귀무가설을 기각한다 -> 대립가설을 채택한다 -> 위 샘플의 전과 후의 평균은 차이가 있다.
